% Test curves
irf = sim_tcspc_irfs(0.047,zeros(256,1),[20000, 0.8, 0.25, 0, 0],1);
trans = horzcat(sim_tcspc_dks(0.047,irf,zeros(256,1),[200000, 2, 100000, 1, 0, 0, 0, 0],2,10),...
    sim_tcspc_dks(0.047,irf,zeros(256,1),[100000, 2, 200000, 1, 0, 0, 0, 0],2,10));
%% Test 1: Proper lifetime extraction
results = fit_tcspc_dks_nlls(0.047,trans,irf,zeros(256,1),1,256,...
    [0.1, 3, 0.05, 1.5, 0, 0, 0, 0],vertcat(false(4,1),true(4,1)),...
    [false true false true false(1,4)],2,0,"EngineOptions",optimoptions("lsqnonlin",...
    "SpecifyObjectiveGradient",true));